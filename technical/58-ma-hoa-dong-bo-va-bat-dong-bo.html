<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mã hoá đồng bộ và bất đồng bộ | Minh Nhật’s blog</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Mã hoá đồng bộ và bất đồng bộ" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Outline Encode và encryption Mã hoá đồng bộ (symmetric) và bất đồng bộ (asymmetric) Token và microservice" />
<meta property="og:description" content="Outline Encode và encryption Mã hoá đồng bộ (symmetric) và bất đồng bộ (asymmetric) Token và microservice" />
<link rel="canonical" href="/technical/58-ma-hoa-dong-bo-va-bat-dong-bo" />
<meta property="og:url" content="/technical/58-ma-hoa-dong-bo-va-bat-dong-bo" />
<meta property="og:site_name" content="Minh Nhật’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-09-20T00:01:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Mã hoá đồng bộ và bất đồng bộ" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-09-20T00:01:00+00:00","datePublished":"2023-09-20T00:01:00+00:00","description":"Outline Encode và encryption Mã hoá đồng bộ (symmetric) và bất đồng bộ (asymmetric) Token và microservice","headline":"Mã hoá đồng bộ và bất đồng bộ","mainEntityOfPage":{"@type":"WebPage","@id":"/technical/58-ma-hoa-dong-bo-va-bat-dong-bo"},"url":"/technical/58-ma-hoa-dong-bo-va-bat-dong-bo"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Minh Nhật&apos;s blog" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Minh Nhật&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <!-- <div class="trigger"><a class="page-link" href="/404.html"></a><a class="page-link" href="/about/">Về tôi</a><a class="page-link" href="/art">art</a><a class="page-link" href="/finance">Finance</a><a class="page-link" href="/"></a><a class="page-link" href="/assets/main.css"></a><a class="page-link" href="/opinion">opinion</a><a class="page-link" href="/philosophy">Philosophy</a><a class="page-link" href="/technical">technical</a><a class="page-link" href="/art">art</a><a class="page-link" href="/art/">art</a><a class="page-link" href="/finance">Finance</a><a class="page-link" href="/finance/">Finance</a><a class="page-link" href="/"></a><a class="page-link" href="/"></a><a class="page-link" href="/page1/"></a><a class="page-link" href="/page2/"></a><a class="page-link" href="/page3/"></a><a class="page-link" href="/page4/"></a><a class="page-link" href="/opinion">opinion</a><a class="page-link" href="/opinion/">opinion</a><a class="page-link" href="/philosophy">Philosophy</a><a class="page-link" href="/philosophy/">Philosophy</a><a class="page-link" href="/technical">technical</a><a class="page-link" href="/technical/">technical</a><a class="page-link" href="/feed.xml"></a></div> -->
        <div class="trigger">
          <a class="page-link" href="/philosophy">Triết học</a>
          <a class="page-link" href="/art">Văn, thơ, nhạc</a>
          <a class="page-link" href="/opinion">Góc nhìn cá nhân</a>
          <a class="page-link" href="/technical">IT</a>
          <a class="page-link" href="/finance">Finance</a>
          <a class="page-link" href="/about">Về tôi</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">58. Mã hoá đồng bộ và bất đồng bộ</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-09-20T00:01:00+00:00" itemprop="datePublished">Sep 20, 2023
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Outline</p>
<ol>
  <li>Encode và encryption</li>
  <li>Mã hoá đồng bộ (symmetric) và bất đồng bộ (asymmetric)</li>
  <li>Token và microservice</li>
</ol>

<h2 id="1-encode-và-encryption">1. Encode và encryption</h2>
<h3 id="11-encode">1.1 Encode</h3>
<p>Encode là quá trình chuyển đổi data sang 1 định dạng mới, dựa theo những mô hình công khai sẵn có (publicly available) và có thể dễ dàng đảo ngược. Qúa trình đảo ngược gọi là decode.</p>

<p>Encode chỉ chuyển dữ liệu sang 1 định dạng khác để có thể sử dụng trên 1 hệ thống khác. Ví dụ: chuyển từ text sang byte</p>

<p>Encode không hề bảo mật.</p>

<p>Thuật toán hay sử dụng: ASCII, Unicode, URL Encoding, Base64</p>

<h3 id="12-encryption">1.2 Encryption</h3>
<p>Encryption là quá trình chuyển đổi data sang 1 định dạng mới, và chỉ những đối tượng cụ thể mới có thể đảo ngược. Quá trình đảo ngược gọi là decryption</p>

<p>Mục đính của encryption là giữ bí mật cho dữ liệu, chỉ một vài người có key mới biết được nội dung. Đảm bảo chỉ những người đủ điều kiện mới có thể truy suất dữ liệu</p>

<p>Thuật toán hay sử dụng: AES, RSA</p>

<p>Thuật ngữ</p>

<p>Plain text –&gt; encryption –&gt; Cipher text</p>

<h2 id="2-mã-hoá-đồng-bộ-symmetric-và-bất-đồng-bộ-asymmetric">2. Mã hoá đồng bộ (symmetric) và bất đồng bộ (asymmetric)</h2>
<h3 id="21-symmetric-encryption">2.1 Symmetric encryption</h3>
<p>Symmetric encryption dùng 1 secret key cho cả encrypt và decrypt. Key này được shared chung</p>

<p>Điểm mạnh là mã hoá đồng bộ nhanh, ít tốt CPU và Cipher text không phình ra so với dữ liệu gốc.</p>

<p>Điểm yếu là tính bảo mật thấp, do phải shared secret key.</p>

<p>Thuật toán: AES (128, 192 hoặc 256 bit. Phổ biến), ChaCha20. Không dùng DES, RC4</p>

<h3 id="22-asymmetric-encryption">2.2 Asymmetric encryption</h3>
<p>Asymmetric encryption, còn được gọi là public-key encryption, sử dụng 1 cặp public key - private key: dữ liệu được encrypt bởi private key thì được decrypt bởi public key. Nếu encrypt bởi public key thì được decrypt bởi private key. 2 key này có quan hệ toán học với nhau</p>

<p>Điểm mạnh là bảo mật hơn symmetric encryption, do không shared private key</p>

<p>Tuy nhiên, điểm yếu là quá trình encrypt diễn ra chậm, tốn nhiều CPU và cipher text thường phình to hơn dữ liệu gốc.</p>

<p>Thuật toán phổ biến: RSA (phổ biến), Diffie-Hellman, ECDSA, ECDH. Không dùng DSA</p>

<h2 id="3-token-và-microservice">3. Token và microservice</h2>
<p>Giả sử, ta có 1 kiến trúc microserivce và sử dụng symmetric encryption như sau 
<img src="/assets/images/2023/2023_09_20_symmetric_encryption.png" alt="Symmetric encryption" title="Symmetric encryption" /></p>
<ul>
  <li>Auth service: có nhiệm vụ login, cấp access token và verify access token</li>
  <li>Image service, resource service: request tới các service này sẽ kèm theo access token. Nếu access token hợp lệ, được phép sử dụng service</li>
</ul>

<p>Thông thường, Auth serivce sẽ làm nhiệm vụ cấp và verify token. Khi Image serivce cần verify token, nó sẽ gọi api của Auth service. Tuy nhiên, việc này cũng tạo ra bottleneck tại Auth serivce tại một vài thời điểm, nhất là khi số lượng service tăng lên. Để tránh điều này, ta có thể verify token ngay tại Image serivce, ko cần gọi Auth service nữa.</p>

<p>Nếu ta sử dụng symmetric encryption, việc leak secret key là có thể xảy ra. Lúc này, hacker có thể tự tạo 1 valid access token để truy cập vào Image service. Hơn nữa, không thể verify tại client-side, vì không bao giờ được phép để secret key phía client</p>

<p>Một giải pháp là sử dụng asymmetric encryption. Sử dụng private key để sign và public key để verify. Private Key chỉ tồn tại tại Auth service –&gt; không ai có thể tạo token ngoài Auth service. Public key sẽ được phân phối tới các service thông qua 1 url chứa toàn bộ available public key (URl gọi là json web keys set). Ta có thể cache lại public key này trong 1 khoảng thời gian. Consumer service như Image serivce, sẽ dùng public key để verify token.</p>

<p><img src="/assets/images/2023/2023_09_20_asymmetric_encryption.png" alt="Asymmetric encryption" title="Asymmetric encryption" /></p>

<p>Lưu ý, với cách làm trên, sau khi verify token tại Image service, ta trực tiếp sử dụng thông tin trong payload của token, mà không kiểm tra lại xem token này có được lưu trong database hay không. Để làm điều này, cần đảm bảo payload trong token không bị thay đổi bởi bên thứ 3. Signature trong Json Web Token cho phép ta thực hiện việc này.</p>

<p>Tuy nhiên, vì không lưu nội dung token trong database, không thể thực hiện tính năng revoke token tức thời được. (Dù cho có set expried time thấp, nhưng vẫn không tức thời). Do số lượng revoke token không nhiều, ta có thể lưu token bị revoke vào database và kiểm tra mỗi khi verify token. Lúc này, có thể sẽ bị bottleneck ở khúc kiểm tra revoke token. Căn cứ vào lượng request mà chọn phương án phù hợp.</p>

<p><strong>Referene:</strong></p>
<ol>
  <li><a href="https://www.youtube.com/watch?v=KQPuPbaf7vk">How to use JWT with RSA key-pair in micro-services</a></li>
  <li><a href="https://dzone.com/articles/using-jwt-in-a-microservice-architecture">Using JWT in a Microservice Architecture</a></li>
  <li><a href="https://www.youtube.com/watch?v=o_g-M7UBqI8">Encryption - Symmetric Encryption vs Asymmetric Encryption - Cryptography - Practical TLS</a></li>
</ol>


  </div><a class="u-url" href="/technical/58-ma-hoa-dong-bo-va-bat-dong-bo" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Contact</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Minh Nhật&#39;s blog</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
